
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= title %> - About</title>
    <% include templates/styletemplate.ejs %>

    <style>
    	.message-container{
    		padding: 3rem;
    		max-height: 30rem;
    		overflow-y: auto;
    	}

    	.title{
    	}
    	.title span{
    		text-decoration: none;
    	}

		.message-bubble{
			padding: 3px;
			border: 1px solid #e0e0e0;
			background-color: #f3f3f3;
			border-radius: 10px;
			margin-bottom: 1rem;
		}

    </style>
 
<body ng-app="messageBoard" ng-controller="msgCtrl">

	<div class="row">
		<h2><span class="col-xs-1">#</span>
		<a href="#" class="col-xs-6"><%= helloString %></a>
		<div class="col-xs-5"><hr></div>
		</h2>
	</div>

	<div class="panel panel-default">
		<div class="panel-body message-container" id="msgContainer">
			<div class="message-bubble" ng-repeat="x in msgList">
			    <input type="checkbox" ng-model="x.done"> <span ng-bind="x.msgText"></span>
			</div>
		</div>
	</div>

	<p>Add a new message to the message board: </p>
	<form ng-submit="msgAdd()">
	<div class="form-group">
	  <label for="msg">Name:</label>
	  <div class="row">
		<div class="col-md-8 col-xs-8">
			<input type="text" class="form-control" id="msg" onblur="keepFocus()" ng-model="msgInput" placeholder="Add New">
		</div>
		<div class="col-md-4">
			<!-- Send vanilla js-->
			<!--
			<button type="button" class="btn btn-primary" onclick="appendMessage()">Send</button>
			<button type="button" class="btn btn-danger" onclick="deleteAllMessages()">Delete all</button>
			-->
			<!-- Send ng -->
			<input type="submit" class="btn btn-primary" value="Send">
		</div>
	  </div>
	</div>
	</form>

	<!-- Remove ng -->
	<p><button class="btn btn-warning" ng-click="msgRemove()">Remove marked</button></p>
	<p><button class="btn btn-danger" ng-click="msgRemoveAll()">Remove all</button></p>

	<% include templates/scripttemplate.ejs %>

	<!-- Vanilla JS extras -->
	<script>
		window.onload = function() {
		  keepFocus();
		}

		function keepFocus() {
		  document.getElementById("msg").focus();
		}

		/*window.addEventListener("keypress", function(event){
			if(event.keyCode === 13 && document.activeElement !== 'text') {
		        //e.preventDefault();
		        appendMessage();
		    }
		});*/
	</script>

	<!-- Vanilla JS appends --><!--
	<script>
		function appendMessage(){
			//get input value
			var messageInput = document.getElementById('msg').value;
			if(messageInput){
				//create a wrapper node
				var nodeDiv = document.createElement("div");
				//create a content node
				var node = document.createElement("h4");
				//child of content ndoe
				var textnode = document.createTextNode(messageInput);
				node.appendChild(textnode);

				//append content node to wrapper node
				nodeDiv.appendChild(node);

				nodeDiv.className += "message-bubble";

				var container = document.getElementById("msgContainer");
				container.appendChild(nodeDiv);

				//reset the content of the input after posting
				document.getElementById('msg').value = '';

				container.scrollTop = container.scrollHeight;
			}
		}

		function deleteAllMessages(){
			var messageNodes = document.getElementById("msgContainer");
			while (messageNodes.firstChild) {
			    messageNodes.removeChild(messageNodes.firstChild);
			}
		}
	</script>-->


	<!-- Angular style -->
	<script>
		var app = angular.module('messageBoard', []);
		app.controller('msgCtrl', function($scope) {
		    $scope.msgList = [{msgText:'Welcome to the message board !', done:false}];

		    $scope.msgAdd = function() {
		    	if($scope.msgInput){
			        $scope.msgList.push({msgText:$scope.msgInput, done:false});
			        $scope.msgInput = "";

			        var container = document.getElementById("msgContainer");
			        container.scrollTop = container.scrollHeight;
		        }
		    };

		    $scope.msgRemove = function() {
		        /*
		        var oldList = $scope.msgList;
		        $scope.msgList = [];
		        angular.forEach(oldList, function(x) {
		            if (!x.done) $scope.msgList.push(x);
		        });
		        */
		        var count = 0;
		        angular.forEach($scope.msgList, function(x) {
		            if (x.done) {
		            	$scope.msgList.splice(count, 1);
		            }
		            count++;
		        });
		    };

		    $scope.msgRemoveAll = function() {
		        var oldList = $scope.msgList;
		        $scope.msgList = [];
		    };
		});
	</script>

</body>
</html>